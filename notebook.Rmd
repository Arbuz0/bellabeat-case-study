---
title: 'Bellabeat Case Study'
author: '≈Åukasz Janiak'
output: 
  html_document:
    code_folding: show
date: 'in progress'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Sys.setlocale("LC_TIME", "Polish_Poland.1250")
Sys.setlocale("LC_TIME", "C")
```

## Business Task

Questions for analysis:

* What are some trends in smart device usage?
* How could these trends apply to Bellabeat customers?
* How could these trends help influence Bellabeat marketing strategy?

## Data source

Data was downloaded from [Fitbit Fitness Tracker Data](https://www.kaggle.com/datasets/arashnic/fitbit) 
from the Kaggle web repository.  
License: CC0: Public Domain  

This dataset generated by respondents to a distributed survey via Amazon Mechanical Turk between 12.03.2016-12.05.2016. 
Thirty eligible Fitbit users consented to the submission of personal tracker data, 
including minute-level output for physical activity, heart rate, and sleep monitoring. 
Variation between output represents use of different types of Fitbit trackers and individual tracking behaviors / preferences.


## Loading packages

```{r, message = FALSE}
library("readr")
library("ggplot2")
library("dplyr")
library("lubridate")
library("tidyr")
library("janitor")
```

## Importing datasets

```{r, message = FALSE}
daily_activity <- read_csv("Fitabase_Data_4.12.16-5.12.16/dailyActivity_merged.csv") # nolint
hourly_calories <- read_csv("Fitabase_Data_4.12.16-5.12.16/hourlyCalories_merged.csv" ) # nolint
hourly_intensities <- read_csv("Fitabase_Data_4.12.16-5.12.16/hourlyIntensities_merged.csv") # nolint
hourly_steps <- read_csv("Fitabase_Data_4.12.16-5.12.16/hourlySteps_merged.csv")
sleep_day <- read_csv("Fitabase_Data_4.12.16-5.12.16/sleepDay_merged.csv")
heart_rate <- read_csv("Fitabase_Data_4.12.16-5.12.16/heartrate_seconds_merged.csv") # nolint
weight_log <- read_csv("Fitabase_Data_4.12.16-5.12.16/weightLogInfo_merged.csv")
```

## Data Preview {.tabset}

### Daily Activity

```{r}
head(daily_activity)
str(daily_activity)
```

### Hourly Calories

```{r}
head(hourly_calories)
str(hourly_calories)
```

### Hourly Intensities

```{r}
head(hourly_intensities)
str(hourly_intensities)
```

### Hourly Steps

```{r}
head(hourly_steps)
str(hourly_steps)
```

### Sleep Day

```{r}
head(sleep_day)
str(sleep_day)
```

### Heart Rate

```{r}
head(heart_rate)
str(heart_rate)
```

### Weight Log

```{r}
head(weight_log)
str(weight_log)
```

## {-}

## Data cleaning {.tabset}

### Daily Activity

```{r, warning = FALSE}
sum(duplicated(daily_activity))

daily_activity <- daily_activity %>%
  clean_names() %>%
  mutate(activity_date = mdy(activity_date), day_of_week = weekdays(activity_date)) %>% # nolint
  rename("date" = activity_date)

head(daily_activity)
```

### Hourly Calories

```{r, warning = FALSE}
sum(duplicated(hourly_calories))

hourly_calories <- hourly_calories %>%
  clean_names() %>%
  separate(col = activity_hour, into = c("date", "time"), sep = " ") %>%
  mutate(date = mdy(date), day_of_week = weekdays(date))

head(hourly_calories)
```

### Hourly Intensities

```{r, warning = FALSE}
sum(duplicated(hourly_intensities))

hourly_intensities <- hourly_intensities %>%
  clean_names() %>%
  separate(col = activity_hour, into = c("date", "time"), sep = " ") %>%
  mutate(date = mdy(date), day_of_week = weekdays(date))

head(hourly_intensities)
```

### Hourly Steps

```{r, warning = FALSE}
sum(duplicated(hourly_steps))

hourly_steps <- hourly_steps %>%
  clean_names() %>%
  separate(col = activity_hour, into = c("date", "time"), sep = " ") %>%
  mutate(date = mdy(date), day_of_week = weekdays(date))

head(hourly_steps)
```

### Sleep Day

```{r, warning = FALSE}
sum(duplicated(sleep_day))
sleep_day <- distinct(sleep_day)
sum(duplicated(sleep_day))

sleep_day <- sleep_day %>%
  clean_names() %>%
  separate(col = sleep_day, into = c("date", "time"), sep = " ") %>%
  mutate(date = mdy(date), day_of_week = weekdays(date))

head(sleep_day)
```

### Heart Rate

```{r, warning = FALSE}
sum(duplicated(heart_rate))

heart_rate <- heart_rate %>%
  clean_names() %>%
  separate(col = time, into = c("date", "time"), sep = " ") %>%
  mutate(date = mdy(date), day_of_week = weekdays(date))

head(heart_rate)
```

### Weight Log

```{r, warning = FALSE}
sum(duplicated(weight_log))

weight_log <- weight_log %>%
  clean_names() %>%
  mutate(date = date(mdy_hms(date)), day_of_week = weekdays(date)) %>%
  rename("date" = date)

head(weight_log)
str(weight_log)
```

## {-}

## Data validation

Table **'daily_activity'** contains records from **`r min(daily_activity$date)`** 
to **`r max(daily_activity$date)`** and contains **`r n_distinct(daily_activity$id)`** users.  
Table **'hourly_calories'** contains records from **`r min(hourly_calories$date)`** 
to **`r max(hourly_calories$date)`** and contains **`r n_distinct(hourly_calories$id)`** users.  
Table **'hourly_intensities'** contains records from **`r min(hourly_intensities$date)`** 
to **`r max(hourly_intensities$date)`** and contains **`r n_distinct(hourly_intensities$id)`** users.  
Table **'hourly_steps'** contains records from **`r min(hourly_steps$date)`** 
to **`r max(hourly_steps$date)`** and contains **`r n_distinct(hourly_steps$id)`** users.  
Table **'sleep_day'** contains records from **`r min(sleep_day$date)`** 
to **`r max(sleep_day$date)`** and contains **`r n_distinct(sleep_day$id)`** users.  
Table **'heart_rate'** contains records from **`r min(heart_rate$date)`** 
to **`r max(heart_rate$date)`** and contains **`r n_distinct(heart_rate$id)`** users.  
Table **'weight_log'** contains records from **`r min(weight_log$date)`** 
to **`r max(weight_log$date)`** and contains **`r n_distinct(weight_log$id)`** users.  

For further analysis I am going to leave out **'weight_log'** and **'heart_rate'** 
because of insufficient number of unique users.

```{r}
daily_activity %>%
  select(total_steps, total_distance, calories) %>%
  summary()

daily_activity %>%
  select(very_active_minutes, fairly_active_minutes, lightly_active_minutes, sedentary_minutes) %>% # nolint
  summary()
```

In **'daily_activity'** table every measure category minimum is 0. 
The most likely cause is missing data due to users not using app. More data is needed to determine it. 
Need to be careful about that in future steps.

## Analysis

```{r, class.source = 'fold-hide'}
hourly_calories %>%
  group_by(date) %>%
  summarize("unique_users" = n_distinct(id)) %>%
  ggplot() +
    geom_smooth(mapping = aes(x = date, y = unique_users)) +
    geom_point(mapping = aes(x = date, y = unique_users)) +
    labs(title = "Unique users over time",
      subtitle = "Feature: Calories tracker",
      x = "Date",
      y = "Unique users") +
    scale_y_continuous(breaks = seq(0, 36, by = 2), limits = c(0, 36))
```

```{r, class.source = 'fold-hide'}
hourly_steps %>%
  group_by(date) %>%
  summarize("unique_users" = n_distinct(id)) %>%
  ggplot() +
    geom_smooth(mapping = aes(x = date, y = unique_users)) +
    geom_point(mapping = aes(x = date, y = unique_users)) +
    labs(title = "Unique users over time",
      subtitle = "Feature: Steps tracker",
      x = "Date",
      y = "Unique users") +
    scale_y_continuous(breaks = seq(0, 36, by = 2), limits = c(0, 36))
```

```{r, class.source = 'fold-hide'}
hourly_intensities %>%
  group_by(date) %>%
  summarize("unique_users" = n_distinct(id)) %>%
  ggplot() +
    geom_smooth(mapping = aes(x = date, y = unique_users)) +
    geom_point(mapping = aes(x = date, y = unique_users)) +
    labs(title = "Unique users over time",
      subtitle = "Feature: Intensity tracker",
      x = "Date",
      y = "Unique users") +
    scale_y_continuous(breaks = seq(0, 36, by = 2), limits = c(0, 36))
```

These three functions are closely related to each other, they have the same number of users.
Within a month, the application lost around 40 % of users (from 33 to 19).
After 2.5 weeks, the pace of decline began to pick up noticeably.

```{r, class.source = 'fold-hide'}
sleep_day %>%
  group_by(date) %>%
  summarize("unique_users" = n_distinct(id)) %>%
  ggplot() +
    geom_smooth(mapping = aes(x = date, y = unique_users)) +
    geom_point(mapping = aes(x = date, y = unique_users)) +
    labs(title = "Unique users over time",
      subtitle = "Feature: Intensity tracker",
      x = "Date",
      y = "Unique users") +
    scale_y_continuous(breaks = seq(0, 20, by = 2), limits = c(0, 20))
```